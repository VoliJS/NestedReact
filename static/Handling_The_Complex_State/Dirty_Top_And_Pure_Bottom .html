<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Dirty Top And Pure Bottom  - NestedReact</title>
    <meta name="description" content="React. Playing well with traditional MVC." />
    <meta name="author" content="Vlad Balin">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="with-float">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">NestedReact</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../Getting_Started.html">Getting Started</a></li><li class='Nav__item  has-children'><a href="../Basics/State_Management_101.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Basics</a><ul class='Nav'><li class='Nav__item '><a href="../Basics/State_Management_101.html">State Management 101</a></li><li class='Nav__item '><a href="../Basics/Two_way_data_binding.html">Two way data binding</a></li></ul></li><li class='Nav__item Nav__item--open has-children'><a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html" class="folder"><i class="Nav__arrow">&nbsp;</i>Handling The Complex State</a><ul class='Nav'><li class='Nav__item Nav__item--active'><a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html">Dirty Top And Pure Bottom </a></li><li class='Nav__item '><a href="../Handling_The_Complex_State/State_and_Props_Type_Annotations.html">State and Props Type Annotations</a></li><li class='Nav__item '><a href="../Handling_The_Complex_State/Update_Watchers_and_Transactions.html">Update Watchers and Transactions</a></li><li class='Nav__item '><a href="../Handling_The_Complex_State/Ownership_and_Shared_References.html">Ownership and Shared References</a></li></ul></li><li class='Nav__item  has-children'><a href="../Working_With_Forms/Form_Validation.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Working With Forms</a><ul class='Nav'><li class='Nav__item '><a href="../Working_With_Forms/Form_Validation.html">Form Validation</a></li><li class='Nav__item '><a href="../Working_With_Forms/Advanced Data Binding.html">Advanced Data Binding</a></li></ul></li><li class='Nav__item '><a href="../Optimizing_For_Performance.html">Optimizing For Performance</a></li><li class='Nav__item '><a href="../Migration_from_Backbone.html">Migration from Backbone</a></li><li class='Nav__item '><a href="../Using jQuery plugins.html">Using jQuery plugins</a></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/Volicon/NestedReact/issues" target="_blank">Help/Support/Bugs</a>
                        <br />
                                            <a href="http://volicon.com" target="_blank">Made by Volicon (a Verizon company)</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <span class="CodeToggler__text">Code blocks</span>
                            <div class="ButtonGroup" role="group">
                                <button class="Button Button--default Button--small CodeToggler__button CodeToggler__button--hide">No</button>
                                <button class="Button Button--default Button--small CodeToggler__button CodeToggler__button--below">Below</button>
                                <button class="Button Button--default Button--small CodeToggler__button CodeToggler__button--float">Inline</button>
                            </div>
                                            </div>
                
                                    <hr/>
                    <div class="Twitter">
                                                    <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=gaperton&amp;show_count=false"></iframe>
                            <br />
                            <br />
                                            </div>
                            </div>
        </div>
    </aside>
    <div class="Columns__right Columns__right--float">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html">Handling The Complex State</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html">Dirty Top And Pure Bottom </a></h1>
                <span style="float: left; font-size: 10px; color: gray;">
            Thursday, October 13, 2016 12:59 PM        </span>
                        <span style="float: right; font-size: 10px; color: gray;">
            <a href="https://github.com/Volicon/NestedReact/blob/develop/docs/02_Handling_The_Complex_State\01_Dirty_Top_And_Pure_Bottom .md" target="_blank">Edit on GitHub</a>
        </span>
            </div>


    <div class="s-content">
        <p><em>&quot;Complex state&quot;</em> is the state composed of nested parts (typically
other models and collections). It's done with mentioning type
constructors in model or state attribute declaration instead of the default value.</p>
<p>Such a members called <em>aggregated members</em>. When the model is...</p>
<ul>
<li>...created with <code>new</code>, aggregated members are created too.</li>
<li>...cloned with <code>model.clone()</code>, aggregated members are cloned.</li>
<li>...disposed with <code>model.dispose()</code>, aggregated members are disposed.</li>
</ul>
<p>And when nested models and collections are <em>modified</em>, root model holding
React component state detects the change, and force its component to update.
In conjunction, these features allows to to describe fairly complex
components using just component state.</p>
<h2 id="page_Example_unidirectional_data_flow_with_complex_state">Example: unidirectional data flow with complex state</h2>
<p>Here we're demonstrating the main pattern which is used to structure
applications with <code>NestedReact</code>. Top-level &quot;dirty&quot; component holding the complex
mutable state, passing its parts down to &quot;pure&quot; children components with props.</p>
<p>In order to define models which are parts of the React state, you
will need to import <code>Model</code> base class from <code>nestedtypes</code>.</p>
<pre><code class="language-javascript">import { Model, define } from 'nestedtypes'
import React from 'nestedreact'
</code></pre>
<p>It doesn't matter where <code>@define</code> decorator comes from, it's the same.
Now lets define some simple model.</p>
<pre><code class="language-javascript">@define
class Counter extends Nested.Model {
    static attributes = {
        count : 0
    }
}
</code></pre>
<p>Then, use it to define more complex structure.
Model collection can be referenced as <code>Model.Collection</code>, and mostly
conforms to <a href="http://backbonejs.org/#Collection" class="external">BackboneJS collection API</a>.
They can be created directly with <code>new</code> or used as attribute type.</p>
<pre><code class="language-javascript">@define
class ComplexState extends Nested.Model {
    static attributes = {
        created  : Date,
        counter  : Counter,
        counters : Counter.Collection 
    }
}
</code></pre>
<p>And now, let's define some root component managing the complex UI state.</p>
<pre><code class="language-javascript">@define
class View extends React.Component {
    static state = { // &lt;- define the model describing UI state
        dummy : ComplexState 
    }
    
    render(){
        return (
            &lt;div&gt;
                { this.state.dummy.counters.map( counter =&gt; (
                    &lt;CounterItem key={ counter.cid } model={ counter } /&gt;                            
                ) ) }
            &lt;/div&gt;
        );
    }
}
</code></pre>
<p>And finally, we can make pure component for the counter, receiving
the nested model in props. It will handle the click,
and increment the counter. Which will be noticed by the root component
because this counter is the part of its complex state, thus it will trigger
UI update.</p>
<pre><code class="language-javascript">const CounterItem = ({ model }) =&gt; (
    &lt;div onClick={ () =&gt; model.counter++ }&gt;
        { model.counter }    
    &lt;/div&gt;
);
</code></pre>
<blockquote>
<p>Conceptually, this is the most common pattern of structuring an application
in the majority of the functional languages which are used for production in the wild.
Those like OCaml (and F#), or Erlang (and Elixir).</p>
</blockquote>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Basics/Two_way_data_binding.html">Previous</a></li>            <li class=Pager--next><a href="../Handling_The_Complex_State/State_and_Props_Type_Annotations.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
