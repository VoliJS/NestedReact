<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Update Watchers and Transactions - NestedReact</title>
    <meta name="description" content="React. Playing well with traditional MVC." />
    <meta name="author" content="Vlad Balin">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class="with-float">
    
<header class="Navbar hidden-print">
    <a class="Navbar__brand" href="../index.html">NestedReact</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451"><path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/></svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on" results=25 autosave=text_search>
    </div>
</header>
<div class="Columns content">
    <aside class="Columns__left Collapsible">
        <div class="Collapsible__container">
            <button type="button" class="Button Collapsible__trigger">
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
                <span class="Collapsible__trigger--bar"></span>
            </button>
        </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item '><a href="../Getting_Started.html">Getting Started</a></li><li class='Nav__item  has-children'><a href="../Basics/State_Management_101.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Basics</a><ul class='Nav'><li class='Nav__item '><a href="../Basics/State_Management_101.html">State Management 101</a></li><li class='Nav__item '><a href="../Basics/Two_way_data_binding.html">Two way data binding</a></li></ul></li><li class='Nav__item Nav__item--open has-children'><a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html" class="folder"><i class="Nav__arrow">&nbsp;</i>Handling The Complex State</a><ul class='Nav'><li class='Nav__item '><a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html">Dirty Top And Pure Bottom </a></li><li class='Nav__item '><a href="../Handling_The_Complex_State/State_and_Props_Type_Annotations.html">State and Props Type Annotations</a></li><li class='Nav__item Nav__item--active'><a href="../Handling_The_Complex_State/Update_Watchers_and_Transactions.html">Update Watchers and Transactions</a></li><li class='Nav__item '><a href="../Handling_The_Complex_State/Ownership_and_Shared_References.html">Ownership and Shared References</a></li></ul></li><li class='Nav__item  has-children'><a href="../Working_With_Forms/Form_Validation.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Working With Forms</a><ul class='Nav'><li class='Nav__item '><a href="../Working_With_Forms/Form_Validation.html">Form Validation</a></li><li class='Nav__item '><a href="../Working_With_Forms/Advanced Data Binding.html">Advanced Data Binding</a></li></ul></li><li class='Nav__item '><a href="../Optimizing_For_Performance.html">Optimizing For Performance</a></li><li class='Nav__item '><a href="../Migration_from_Backbone.html">Migration from Backbone</a></li><li class='Nav__item '><a href="../Using jQuery plugins.html">Using jQuery plugins</a></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="https://github.com/Volicon/NestedReact/issues" target="_blank">Help/Support/Bugs</a>
                        <br />
                                            <a href="http://volicon.com" target="_blank">Made by Volicon (a Verizon company)</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <span class="CodeToggler__text">Code blocks</span>
                            <div class="ButtonGroup" role="group">
                                <button class="Button Button--default Button--small CodeToggler__button CodeToggler__button--hide">No</button>
                                <button class="Button Button--default Button--small CodeToggler__button CodeToggler__button--below">Below</button>
                                <button class="Button Button--default Button--small CodeToggler__button CodeToggler__button--float">Inline</button>
                            </div>
                                            </div>
                
                                    <hr/>
                    <div class="Twitter">
                                                    <iframe allowtransparency="true" frameborder="0" scrolling="no" style="width:162px; height:20px;" src="https://platform.twitter.com/widgets/follow_button.html?screen_name=gaperton&amp;show_count=false"></iframe>
                            <br />
                            <br />
                                            </div>
                            </div>
        </div>
    </aside>
    <div class="Columns__right Columns__right--float">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../Handling_The_Complex_State/Dirty_Top_And_Pure_Bottom .html">Handling The Complex State</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../Handling_The_Complex_State/Update_Watchers_and_Transactions.html">Update Watchers and Transactions</a></h1>
                <span style="float: left; font-size: 10px; color: gray;">
            Thursday, October 13, 2016 3:55 PM        </span>
                        <span style="float: right; font-size: 10px; color: gray;">
            <a href="https://github.com/Volicon/NestedReact/blob/develop/docs/02_Handling_The_Complex_State\03_Update_Watchers_and_Transactions.md" target="_blank">Edit on GitHub</a>
        </span>
            </div>


    <div class="s-content">
        <p>NestedTypes (and NestedReact) gives you precise control over
the way how state is being changed, allowing you to watch attributes
for changes and attach some reactions to it. This (and variety of
other things) can be done with the help of <code>has</code> type annotation.</p>
<p>In this example, we have <code>local</code> state member, which is a string. On every
change it will call the <em>watcher</em> function, which is taken from the props.</p>
<pre><code class="language-javascript">@define
const MyComponent extends React.Component {
    static props = {
        callback : Function.value( x =&gt; void 0 )    
    }
    
    static state = {
        local : String.has.watcher( '^props.callback' )    
    }
    
    render(){ ... }
}
</code></pre>
<p><code>.has.watcher( path | function )</code> annotation either takes &quot;watcher&quot; function
as an argument, or the string <em>path</em> to the watcher function taken relative to the current
model's <code>this</code>. <code>^</code> in the path is the shorthand for the <code>getOwner()</code> call, which in our case returns
React component itself. So, <code>^props.callback</code> is being translated to this:</p>
<p><code>this.getOwner().props.callback</code>.</p>
<h2 id="page_How_watchers_works">How watchers works</h2>
<p>NestedTypes is mostly backward compatible with BackboneJS in term of <a href="http://backbonejs.org/#Events-catalog" class="external">events
emitted by models and collections</a>.
The difference is that mechanics of change events and updates is generalized
on the case of nested models and collection.</p>
<h3 id="page_How_model_tree_handles_an_update">How model tree handles an update</h3>
<p>All updates are executed in the scope of transactions, and transaction
have three stages.</p>
<p>At the first stage, update is applied and attributes receive the new values.</p>
<p>At the second stage, <code>change:attrName</code> event is being triggered for every
changed attribute. Any additional changes to the current models and its
attributes which made as a reaction to these events are executed in the scope of
the same transaction and will trigger additional <code>change:attr</code> events.</p>
<p>At the third stage, model triggers <code>change</code> event, and when <code>change</code> event
processing sequence is done, it closes the transaction and notifies upper
level model, collection, or React component (if any) of change.</p>
<p>Therefore, change events handlers are synchronous, but <em>they are executed as wave
from bottom to the top</em>. And updates made from inside of the handlers
won't result in additional change events at the upper levels.</p>
<p><em>Attribute watcher</em> behaves mostly similar to <code>change:attrName</code> event handler,
with the following differences:</p>
<ul>
<li>Relative symbolic references (paths) to event handlers are allowed,
and handler is called with the right context according to the path.</li>
<li>Event handler receives the new attribute value as first argument.</li>
<li>Event handler can be missing, it's fine.</li>
</ul>
<p>For the case of the collection, the transactions mechanic is the same, with
a difference that individual model's <code>add</code>, <code>remove</code>, and <code>change</code> events are
emitted during the phase 2 instead of <code>change:attrName</code>, and <code>changes</code> event
is triggered at the stage 3 instead of <code>change</code>.</p>
<h3 id="page_Explicit_transactions_control">Explicit transactions control</h3>
<p>Every model attribute assignment or collection modification create implicit
transaction which triggers the wave of change events from the bottom to the top.</p>
<p>You can group the series of modifications to the single transaction
explicitly with <code>transaction()</code> method.</p>
<pre><code class="language-javascript">my.model.transaction( model =&gt; {
    model.a = 1;
    model.and.nested.attr = 2;
    model.itemsCollection.add( { id: 1, name : 'Hi' } );
});
</code></pre>
<p>This code executed synchronously and results in the single <code>change</code>
event triggered by <code>my.model</code> <em>only in case</em> there have been any real
changes made, i.e. <code>model.a</code> wasn't already equal to 1 and so on.</p>
<p>This technique works for both models and collections, can improve performance,
and reduce overall amount of renders. Additionally, collection has
transactional version of <code>each()</code> method (<code>collection.updateEach()</code>)
which iterates through the collection in the scope of transaction.</p>
<p>There are other methods of model and collection which are transactional:</p>
<ul>
<li>
<code>model.set( { a : 1, b : 2, ... } )</code>
</li>
<li>
<code>collection.set( ... )</code>, <code>collection.add( ... )</code>, <code>collection.remove( ... )</code>
</li>
</ul>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Handling_The_Complex_State/State_and_Props_Type_Annotations.html">Previous</a></li>            <li class=Pager--next><a href="../Handling_The_Complex_State/Ownership_and_Shared_References.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
